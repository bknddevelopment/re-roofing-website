<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R&E Roofing - Browser Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .test-results {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
        }

        .test-section h2 {
            font-size: 1.5rem;
            color: #1f2937;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .test-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            background: #f9fafb;
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s;
        }

        .test-item.pass {
            background: #f0fdf4;
            border-left-color: #10b981;
        }

        .test-item.fail {
            background: #fef2f2;
            border-left-color: #ef4444;
        }

        .test-item.pending {
            background: #fffbeb;
            border-left-color: #f59e0b;
        }

        .test-icon {
            font-size: 20px;
            margin-right: 12px;
            min-width: 24px;
        }

        .test-name {
            flex: 1;
            font-weight: 500;
            color: #374151;
        }

        .test-status {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
            text-transform: uppercase;
        }

        .test-status.pass {
            background: #d1fae5;
            color: #065f46;
        }

        .test-status.fail {
            background: #fee2e2;
            color: #991b1b;
        }

        .test-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 30px;
            text-align: center;
        }

        .summary h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat {
            flex: 1;
            min-width: 150px;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        .test-details {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 4px;
            padding-left: 36px;
        }

        .iframe-container {
            margin: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            display: none;
        }

        .iframe-container.show {
            display: block;
        }

        .iframe-container iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #667eea);
            transition: width 0.5s ease;
            width: 0%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>R&E Roofing Test Suite</h1>
            <p>Automated Browser Testing for Multi-Page Site</p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="runAllTests()">Run All Tests</button>
            <button class="btn btn-success" onclick="runQuickTests()">Quick Test</button>
            <button class="btn btn-danger" onclick="clearResults()">Clear Results</button>
            <button class="btn btn-primary" onclick="toggleIframe()">Toggle Preview</button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="iframe-container" id="iframeContainer">
            <iframe id="testIframe" src="index.html"></iframe>
        </div>

        <div class="test-results" id="testResults">
            <p style="text-align: center; color: #6b7280; padding: 60px 20px;">
                Click "Run All Tests" to begin testing
            </p>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h2>Test Summary</h2>
            <div class="summary-stats">
                <div class="stat">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="passedTests" style="color: #10b981;">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="failedTests" style="color: #ef4444;">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="passRate">0%</div>
                    <div class="stat-label">Pass Rate</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        let iframe;

        function initIframe() {
            iframe = document.getElementById('testIframe');
            return new Promise((resolve) => {
                iframe.onload = () => {
                    setTimeout(resolve, 500); // Wait for scripts to initialize
                };
                if (iframe.contentDocument.readyState === 'complete') {
                    setTimeout(resolve, 500);
                }
            });
        }

        function getIframeDocument() {
            return iframe.contentDocument || iframe.contentWindow.document;
        }

        function getIframeWindow() {
            return iframe.contentWindow;
        }

        async function runAllTests() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
            document.getElementById('iframeContainer').classList.add('show');

            await initIframe();

            await runFileStructureTests();
            await runNavigationTests();
            await runModalTests();
            await runMobileMenuTests();
            await runChatTests();
            await runLinkTests();

            displayResults();
            updateSummary();
        }

        async function runQuickTests() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').style.display = 'none';

            await initIframe();

            await runNavigationTests();
            await runModalTests();

            displayResults();
            updateSummary();
        }

        function addTestResult(section, name, passed, details = '') {
            testResults.push({ section, name, passed, details });
            updateProgress();
        }

        function updateProgress() {
            const progress = document.getElementById('progressBar');
            const percent = (testResults.length / 50) * 100; // Estimate 50 total tests
            progress.style.width = Math.min(percent, 100) + '%';
        }

        async function runFileStructureTests() {
            const section = 'File Structure';

            // Test if index.html loads
            const doc = getIframeDocument();
            addTestResult(section, 'Index.html loads', !!doc.body, 'Page loads successfully');

            // Test for CSS
            const styles = doc.querySelectorAll('link[rel="stylesheet"]');
            addTestResult(section, 'CSS files linked', styles.length > 0, `Found ${styles.length} stylesheet(s)`);

            // Test for JavaScript
            const scripts = doc.querySelectorAll('script[src]');
            addTestResult(section, 'JavaScript files linked', scripts.length > 0, `Found ${scripts.length} script(s)`);

            // Test for main elements
            addTestResult(section, 'Header exists', !!doc.querySelector('.header'), 'Header element found');
            addTestResult(section, 'Footer exists', !!doc.querySelector('.footer'), 'Footer element found');
        }

        async function runNavigationTests() {
            const section = 'Navigation';
            const doc = getIframeDocument();

            // Desktop navigation
            const desktopNav = doc.querySelector('.nav-menu');
            addTestResult(section, 'Desktop navigation exists', !!desktopNav, 'Desktop nav menu found');

            if (desktopNav) {
                const navLinks = desktopNav.querySelectorAll('a');
                addTestResult(section, 'Desktop navigation has links', navLinks.length >= 5, `Found ${navLinks.length} navigation links`);
            }

            // Mobile navigation
            const mobileNav = doc.querySelector('.mobile-nav');
            addTestResult(section, 'Mobile navigation exists', !!mobileNav, 'Mobile nav menu found');

            // Check for navigation links
            const homeLink = doc.querySelector('a[href="index.html"]');
            addTestResult(section, 'Home link exists', !!homeLink, 'Home navigation link found');

            const servicesLink = doc.querySelector('a[href="/pages/core/services.html"]');
            addTestResult(section, 'Services link exists', !!servicesLink, 'Services navigation link found');

            // Check for dropdown
            const dropdown = doc.querySelector('.has-dropdown');
            addTestResult(section, 'Dropdown menu exists', !!dropdown, 'Dropdown navigation found');
        }

        async function runModalTests() {
            const section = 'Contact Modal';
            const doc = getIframeDocument();
            const win = getIframeWindow();

            // Check modal exists
            const modal = doc.getElementById('contactModal');
            addTestResult(section, 'Contact modal exists', !!modal, 'Modal element found in DOM');

            if (!modal) return;

            // Check form elements
            const form = doc.getElementById('contactForm');
            addTestResult(section, 'Contact form exists', !!form, 'Form element found');

            const firstName = doc.getElementById('firstName');
            addTestResult(section, 'First name field exists', !!firstName, 'First name input found');

            const lastName = doc.getElementById('lastName');
            addTestResult(section, 'Last name field exists', !!lastName, 'Last name input found');

            const email = doc.getElementById('email');
            addTestResult(section, 'Email field exists', !!email, 'Email input found');

            const phone = doc.getElementById('phone');
            addTestResult(section, 'Phone field exists', !!phone, 'Phone input found');

            // Test modal open functionality
            const ctaButtons = doc.querySelectorAll('.cta-button');
            if (ctaButtons.length > 0) {
                const initialDisplay = win.getComputedStyle(modal).display;
                addTestResult(section, 'Modal initially hidden', initialDisplay === 'none' || !modal.classList.contains('show'), 'Modal not visible on page load');

                // Try to open modal
                ctaButtons[0].click();
                await new Promise(resolve => setTimeout(resolve, 100));
                const openDisplay = modal.classList.contains('show');
                addTestResult(section, 'Modal opens on CTA click', openDisplay, 'Modal shows after clicking CTA button');

                // Test close button
                const closeBtn = doc.querySelector('.close-modal');
                if (closeBtn) {
                    closeBtn.click();
                    await new Promise(resolve => setTimeout(resolve, 100));
                    const closedDisplay = !modal.classList.contains('show');
                    addTestResult(section, 'Modal closes on X click', closedDisplay, 'Modal hides after clicking close button');
                }
            }
        }

        async function runMobileMenuTests() {
            const section = 'Mobile Menu';
            const doc = getIframeDocument();

            // Check mobile menu toggle
            const mobileToggle = doc.querySelector('.mobile-menu-toggle');
            addTestResult(section, 'Mobile menu toggle exists', !!mobileToggle, 'Hamburger menu button found');

            const mobileNav = doc.querySelector('.mobile-nav');
            addTestResult(section, 'Mobile navigation exists', !!mobileNav, 'Mobile nav container found');

            if (mobileToggle && mobileNav) {
                // Test toggle functionality
                const initialActive = mobileNav.classList.contains('active');
                addTestResult(section, 'Mobile menu initially closed', !initialActive, 'Mobile menu not active on page load');

                mobileToggle.click();
                await new Promise(resolve => setTimeout(resolve, 100));
                const openActive = mobileNav.classList.contains('active');
                addTestResult(section, 'Mobile menu opens on toggle', openActive, 'Mobile menu becomes active after click');

                // Close it
                mobileToggle.click();
                await new Promise(resolve => setTimeout(resolve, 100));
                const closedActive = !mobileNav.classList.contains('active');
                addTestResult(section, 'Mobile menu closes on toggle', closedActive, 'Mobile menu closes after second click');
            }
        }

        async function runChatTests() {
            const section = 'Live Chat';
            const doc = getIframeDocument();

            // Check chat widget exists
            const liveChat = doc.getElementById('liveChat');
            addTestResult(section, 'Live chat widget exists', !!liveChat, 'Chat widget found in DOM');

            if (!liveChat) return;

            const chatToggle = doc.querySelector('.chat-toggle');
            addTestResult(section, 'Chat toggle button exists', !!chatToggle, 'Chat toggle button found');

            const chatWindow = doc.querySelector('.chat-window');
            addTestResult(section, 'Chat window exists', !!chatWindow, 'Chat window container found');

            const chatInput = doc.getElementById('chatInput');
            addTestResult(section, 'Chat input exists', !!chatInput, 'Chat input field found');

            // Test chat open/close
            if (chatToggle && chatWindow) {
                const initialActive = chatWindow.classList.contains('active');
                addTestResult(section, 'Chat initially closed', !initialActive, 'Chat window not visible on load');

                chatToggle.click();
                await new Promise(resolve => setTimeout(resolve, 100));
                const openActive = chatWindow.classList.contains('active');
                addTestResult(section, 'Chat opens on toggle', openActive, 'Chat window opens after click');

                // Close it
                const closeBtn = doc.querySelector('.chat-close');
                if (closeBtn) {
                    closeBtn.click();
                    await new Promise(resolve => setTimeout(resolve, 100));
                    const closedActive = !chatWindow.classList.contains('active');
                    addTestResult(section, 'Chat closes on X click', closedActive, 'Chat window closes after clicking X');
                }
            }
        }

        async function runLinkTests() {
            const section = 'Links & Pages';
            const doc = getIframeDocument();

            // Check for broken links (missing pages)
            const requiredPages = ['services.html', 'calculator.html', 'about.html', 'reviews.html', 'faq.html', 'blog.html'];

            for (const page of requiredPages) {
                const links = doc.querySelectorAll(`a[href="${page}"]`);
                const exists = links.length > 0;
                addTestResult(section, `Links to ${page} exist`, exists, exists ? `Found ${links.length} link(s) to ${page}` : `No links to ${page} found`);
            }

            // Note: We can't actually check if pages exist without fetching them
            addTestResult(section, 'Note: Page existence not verified', true, 'Would need server to verify actual page files exist');
        }

        function displayResults() {
            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '';

            // Group by section
            const sections = {};
            testResults.forEach(result => {
                if (!sections[result.section]) {
                    sections[result.section] = [];
                }
                sections[result.section].push(result);
            });

            // Display each section
            for (const [sectionName, tests] of Object.entries(sections)) {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';

                const sectionTitle = document.createElement('h2');
                sectionTitle.textContent = sectionName;
                sectionDiv.appendChild(sectionTitle);

                tests.forEach(test => {
                    const testDiv = document.createElement('div');
                    testDiv.className = `test-item ${test.passed ? 'pass' : 'fail'}`;

                    const icon = document.createElement('span');
                    icon.className = 'test-icon';
                    icon.textContent = test.passed ? '✓' : '✗';
                    testDiv.appendChild(icon);

                    const name = document.createElement('span');
                    name.className = 'test-name';
                    name.textContent = test.name;
                    testDiv.appendChild(name);

                    const status = document.createElement('span');
                    status.className = `test-status ${test.passed ? 'pass' : 'fail'}`;
                    status.textContent = test.passed ? 'Pass' : 'Fail';
                    testDiv.appendChild(status);

                    sectionDiv.appendChild(testDiv);

                    if (test.details) {
                        const details = document.createElement('div');
                        details.className = 'test-details';
                        details.textContent = test.details;
                        sectionDiv.appendChild(details);
                    }
                });

                resultsContainer.appendChild(sectionDiv);
            }
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.style.display = 'block';

            const total = testResults.length;
            const passed = testResults.filter(r => r.passed).length;
            const failed = total - passed;
            const passRate = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('passRate').textContent = passRate + '%';
        }

        function clearResults() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '<p style="text-align: center; color: #6b7280; padding: 60px 20px;">Click "Run All Tests" to begin testing</p>';
            document.getElementById('summary').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
        }

        function toggleIframe() {
            const container = document.getElementById('iframeContainer');
            container.classList.toggle('show');
        }
    </script>
</body>
</html>